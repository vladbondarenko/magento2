define(['jquery','Magento_Ui/js/form/element/abstract','ko','jquery/ui',],function($,Component,ko,jqi){'use strict';var prom=Promise.resolve($.ajax({type:'POST',url:'/novaposhta/ajax/cities',dataType:'json'}));prom.then(function(result_list){var data_arr=JSON.parse(result_list);var result=[];for(var i=0;i<data_arr.length;i++){result.push(new City(data_arr[i]));}
var resarr=ko.observableArray(result);ko.bindingHandlers.jqAuto={init:function(element,valueAccessor,allBindingsAccessor,viewModel){var options=valueAccessor()||{},allBindings=allBindingsAccessor(),unwrap=ko.utils.unwrapObservable,modelValue=allBindings.jqAutoValue,source=resarr,valueProp=allBindings.jqAutoSourceValue,inputValueProp=allBindings.jqAutoSourceInputValue||valueProp,labelProp=allBindings.jqAutoSourceLabel||valueProp;function writeValueToModel(valueToWrite){if(ko.isWriteableObservable(modelValue)){modelValue(valueToWrite);}else{if(allBindings['_ko_property_writers']&&allBindings['_ko_property_writers']['jqAutoValue'])
allBindings['_ko_property_writers']['jqAutoValue'](valueToWrite);}}
options.select=function(event,ui){writeValueToModel(ui.item?ui.item.actualValue:null);};options.change=function(event,ui){var currentValue=$(element).val();var matchingItem=ko.utils.arrayFirst(unwrap(source),function(item){return unwrap(inputValueProp?item[inputValueProp]:item)===currentValue;});if(!matchingItem){writeValueToModel(null);}}
var mappedSource=ko.dependentObservable(function(){var mapped=ko.utils.arrayMap(unwrap(source),function(item){var result={};result.label=labelProp?unwrap(item[labelProp]):unwrap(item).toString();result.value=inputValueProp?unwrap(item[inputValueProp]):unwrap(item).toString();result.actualValue=valueProp?unwrap(item[valueProp]):item;return result;});return mapped;},null,{disposeWhenNodeIsRemoved:element});mappedSource.subscribe(function(newValue){$(element).autocomplete("option","source",newValue);});options.source=mappedSource();$(element).autocomplete(options);},update:function(element,valueAccessor,allBindingsAccessor,viewModel){var allBindings=allBindingsAccessor(),unwrap=ko.utils.unwrapObservable,modelValue=unwrap(allBindings.jqAutoValue)||'',valueProp=allBindings.jqAutoSourceValue,inputValueProp=allBindings.jqAutoSourceInputValue||valueProp;if(valueProp&&inputValueProp!==valueProp){var source=unwrap(allBindings.jqAutoSource)||[];var modelValue=ko.utils.arrayFirst(source,function(item){return unwrap(item[valueProp])===modelValue;})||{};}
$(element).val(modelValue&&inputValueProp!==valueProp?unwrap(modelValue[inputValueProp]):modelValue.toString());}};});function City(name){this.name=ko.observable(name);this.displayName=ko.dependentObservable(function(){return this.name();},this);}
return Component.extend({defaults:{template:'Magegain_Novaposhta/form/element/city',},myCities:function(){ko.observableArray(resarr);},mySelectedGuid:function(){ko.observable("ec361d63-38ae-4ecc-ab46-6c0ef19ed3ac");}});});